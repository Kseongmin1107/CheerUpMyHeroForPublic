# TeamProject_CheerUpMyHero

## 1. 게임 소개

## Cheer Up, My Hero ⚔️

---

> **장르 : 2D 모바일 전략 디펜스**
> 

> **레퍼런스 : 팔라독, 냥코대전쟁**
> 

---

### 인마 전쟁 지휘관이 되어 전쟁에서 승리하자!

**<Cheer up, My Hero>**는 **영지 경영과 전략 디펜스**의 재미가 함께하는 **2D 모바일** 게임입니다.

한정된 자원으로 유닛 소환을 고민하며 마왕군의 공세를 막아내고 반격하는 **전략 디펜스** 게임입니다.

영지, 전투에서 모은 물자로 건물을 영구적으로 성장 시키고 강화된 전략으로 다시 도전할 수 있습니다.

전략적 선택으로 한계를 돌파하며 전황을 바꾸는 짜릿한 성취감을 느껴보세요!


### **🎯 전략적 깊이를 가진 전통 디펜스의 현대적 재해석**

- 냥코대전쟁, 팔라독 같은 고전 디펜스 구조에 **자원·유닛 관리 전략**을 강화하여
유저가 한정된 자원 안에서 **최적의 판단**을 내리는 재미를 목표로 한다.

### **🔄 영지 경영과 전투의 유기적 순환 구조 확립**

- 내정 단계(자원 생산)와 전투 단계(자원 소비)를 명확히 구분하고,
두 시스템이 서로 영향을 주는 루프 구조를 설계해 **지속적인 성장 동기**를 부여한다.

### **🎬 드라마틱한 전황 전환과 감정 몰입 연출**

- 7분 30초 생존 시 등장하는 용사 일행과 컷 씬 연출을 통해
긴장감과 보상감을 극대화하고, 플레이어의 노력에 대한 감정적 보상을 제공한다.

----------

## 2.  팀원 소개

-   **기획 팀장:** [심낙형] - 기획 총 책임자
    
-   **개발 팀장:** [이원진] - 개발 총 책임자
    
-  **팀원:** [김현수] - 기획 부 책임자, 총무

- **팀원:** [김세웅] - 개발 부 책임자

- **팀원:** [조민석] - 서포터 개발자

- **팀원:** [김성민] - 만능 일꾼 
  
----------
## 3.  개발 기간

2025년 9월 8일 → 2025년 11월 7일

--------

## 4.  시연 영상

<a href="https://www.youtube.com/watch?v=sZYoNX6b5Hc">
  <img src= https://imgur.com/xs8LSCc.png" alt="시연 영상" width="540px">
</a>
<br>

👆 **클릭해서 시연 영상 보러가기**

----------
## 5. 기술 스택 

### IDE

- Visual Studio 2022

### 엔진

- Unity 2022.3.62f2

### 버전/일정 관리

- GitHub
- Notion
- Canva

### AI

- Chat GPT
- Gemini
- Claude
- Novel AI
-----------
## 6.  핵심 매니저 시스템


게임의 주요 데이터와 흐름은 **여러 싱글턴 매니저**로 중앙 관리됩니다.

-   **`GameManager`** : 전투 시작/종료, 승패 판정, 보상·페널티 적용 등 전체 게임 상태 총괄
    
-   **`PlayerDataManager`** : 플레이어 영구 데이터 관리 (재화, 덱, 건물, 유물 등)
    
-   **`DataManager`** : `ScriptableObject` 기반 게임 원본 데이터베이스 관리
    
-   **`UnitManager`** : 전투 중 모든 유닛(`BaseCharacter`) 추적 및 검색
    
-   **`UIManager`** : UI 생성/관리, 뒤로가기 버튼 처리
    
-   **`ObjectPoolManager`** : 유닛, 이펙트, UI 오브젝트 등 반복 생성/삭제되는 오브젝트를 풀링 처리, 성능 최적화 및 GC 부담 최소화
    
-   **`SceneLoader`** : 안정적인 씬 전환

  -   **`EventManager`** : 스크립트(매니저) 간의 직접 참조(결합도)를 낮추고, "이벤트" 발행(Publish)과 구독(Subscribe)을 통해 통신을 중재

  
----------

## 7. 주요 기능 

### 7.1 덱 편성 (`DeckPresetController`)

-   5개의 덱 프리셋과 8개 슬롯 관리
    
-   카드 선택창(`UIUnitCardSelect`)과 연동하여 유닛 배치
    
-   `PlayerDataManager.ActiveDeckIndex`로 전투 연동
    

### 7.2 전투 유닛 AI (`BaseUnitController` 상속)

-   `TargetingRoutine` & `AttackRoutine` 코루틴 기반 행동
    
-   **근접 범위** (`MeleeSplash`) / **원거리 범위** (`RangedSplash`) / **힐러** (`Healer`) 등 역할별 컨트롤러 제공
    

### 7.3 전투 시스템

-   **`EnemyHQ`** : 기본 적 유닛 주기적 스폰
    
-   **`EnemyWaveSystem`** : 웨이브 타이머 기반 대규모 스폰
    
-   **`PlayerHQ`** : 유닛 소환, 파괴 시 패배 판정
    

### 7.4 결과 및 보상 (`RewardPanelUI`)

-   승리: 추가 보상 지급, '다음 스테이지' 진행
    
-   패배: 재화 5% 페널티, '덱 재편성' 이동
    
-   보상 0인 항목은 자동으로 비표시


### 7.5 UI Safe Area 적용
-   게임 화면은 디바이스 화면 전체를 활용하여 몰입감 제공
    
-   UI는 SafeArea 영역 안에서만 배치 → 다양한 화면 비율에서도 UI가 잘리는 문제 방지

### 7.6 데이터 테이블 기반 구조
-   유닛, 스테이지, 유물 등 게임 데이터를 ScriptableObject 형태의 테이블로 관리
    
-   Inspector에서 손쉽게 수정/확장 가능, 데이터와 로직 분리로 유지보수 용이

----------

## 8.  핵심 특징 요약

-   **영지 경영 + 전투**의 이중 구조
    
-   **데이터/행동 분리 아키텍처**로 유닛 확장성 확보
    
-   **Object Pooling** 기반 전투 최적화
    
-   **재사용 가능한 UI 시스템**
    
-   **유닛 AI 루틴화**로 안정적 행동 패턴



----------
## 9. 기술적 의사결정

-   **리스트 기반 유닛 탐색 및 타겟 선정**
    
    -   **이유:**
        
        -   콜리전 기반 판정보다 단순 x값 범위 판정이 가볍다고 판단
            
        -   리스트를 사용하여 캐시 히트 효율을 높임
            
    -   **삭제 시 성능 문제 해결:**
        
        -   일반적인 리스트 삭제(`O(n)`) 대신 **Swap-Back 방식**을 사용하여 `O(1)`로 구현
            
-   **인피니트 스크롤 구현**
    
    -   **리소스 절약 측면:** 스크롤 영역 전체를 생성하지 않고 내부 데이터만 교체하여 불필요한 로딩 제거
        
    -   **유저 경험 측면:** 카드의 시작과 끝을 연결하여 탐색을 편하게 함
        
-   **버튼 세분화**
    
    - 모바일 환경에서는 호버 기능이 없으므로, 터치로 여러 동작이 가능하게끔 구현
 
                  -   짧게 클릭 - 유닛, 유물 소환/사용
                  -   길게 누르기 - 유닛, 유물 정보 팝업 오픈
      
-   **데이터 서버 저장 및 UGS 채택**
     
    - 로컬 데이터 조작(치팅)으로 인한 수익성 악화를 방지하고자, 재화·덱·건물 등 모든 핵심 데이터를 서버에 저장하기로 결정
    
    - 유니티 에디터와의 연동이 용이하고, Cloud Code, Economy, Authentication 등 기획에 필요한 백엔드 기능을 하나의 SDK로 통합 관리할 수 있어 UGS를 채택
 
-   **BackendManager 설계 (네트워크 안정성)**
     
    - 모바일 환경의 불안정한 네트워크(인터넷)는 데이터 요청 실패나 순서 꼬임(Race Condition)을 유발할 수 있었음.
    
    - 모든 네트워크 통신(예: AddResource, SaveData)에 try-catch 예외 처리를 적용하여, 실패 시 사용자에게 "재시도" 기회를 제공하도록 안정성을 확보
 
    - 여러 비동기 요청이 동시에 서버로 전송되어 데이터가 꼬이는 문제를 막기 위해, "순차 큐(QueuedRequest)"를 구현하여 모든 요청에 번호표를 부여하고 순서대로 처리하도록 보장

----------
## 10. 리팩토링

-   **데이터 매니저 리팩토링**
    
    -   프로젝트 초기 데이터 구조 대비 **데이터 구조 고도화** 필요
        
    -   **문제:** 데이터베이스 구조 상 하나의 시트에서 하나의 딕셔너리만 도출 가능 → 1:1 데이터 구조 제한
        
    -   **해결:**
        
        -   리스트 도출 기능을 데이터베이스 외부로 분리
            
        -   각 ScriptableObject 파일에서 리스트를 생성하도록 구현
            
    -   다양한 자료구조와 다중 시트를 사용하는 데이터 테이블을 효율적으로 관리 가능
        
-   **BuildingManager 리팩토링**
    
    -   **문제:**
        
        -   기존 `BuildingManager`가 전역 싱글턴으로 역할 범위가 넓고 불명확
            
        -   메모리 낭비, 코드 의도 파악 어려움, 잠재적 버그 발생 가능
            
    -   **해결:**
        
        -   `BuildingManager` 제거
            
        -   메인 화면 건물 UI만 책임지는 `MainScreenBuildingController` 생성
            
        -   UI 생명주기와 함께 동작하도록 설계
            
    -   **개선 결과:**
        
        -   단일 책임 원칙(Single Responsibility) 적용
            
        -   코드 가독성 및 유지보수성 향상
            
        -   불필요한 전역 상태 제거로 씬 전환 시 발생 가능한 버그 예방
     
-   **PlayerDataManager 리팩토링**
    
    -   **문제:**
        
        -    기존 `PlayerDataManager`가 재화, 덱, 유물 등 플레이어 데이터와 **영지 타일(25개)의 모든 상태, 건물 정보, 시너지 계산 로직**까지 전담하여 "갓 클래스(God Class)"가 됨.
            
        -    단일 책임 원칙(SRP) 위배로, 타일 로직 수정이 재화/덱 로직에 영향을 줄 수 있는 높은 결합도 발생.
            
    -   **해결:**
        
        -   영지(타일) 데이터와 로직(시너지/건물 효과 계산)을 전담하는 **`TileDataHandler` 클래스를 신설**하여 책임 분리.
            
        -   `BuildingGridData`, `TileStatusGrid`, `DetectAllSynergies`, `CalculateTotalBuildingEffects` 등 타일 관련 모든 로직을 `PlayerDataManager`에서 `TileDataHandler`로 이전.
            
      
            
    -   **개선 결과:**
        
        -   '플레이어 데이터'와 '영지 데이터'의 책임을 명확히 분리하여 코드 가독성 및 유지보수성 향상.
            
        -   `PlayerDataManager`는 재화/덱 등 계정 정보에만, `TileDataHandler`는 영지 시스템에만 집중하도록 응집도 향상.
            
 

---------
## 11. 트러블슈팅

-   **원거리 범위 공격 정의 문제**
    
    -   기획 초기 단계에서 폭발형, 관통형 등 원거리 범위 공격의 정의가 명확하지 않음
        
    -   팀 내 합의를 통해 범위 공격 타입을 명확히 정의하고, 각 공격 로직에 적용
        
-   **UI 스크롤 충돌 문제**
    
    -   초기 `OnScroll` 이벤트 사용 시 플레이어 입력과 충돌 발생
        
    -   해결: `DragHandler`로 변경하여 사용자가 입력 중일 때 로직이 동작하지 않도록 처리
        
    -   남은 과제: Drag가 아닌 짧은 터치 입력 처리 로직 필요
        
-   **성능 최적화 문제**
    
    -   스프라이트 아틀라스 최적화 전, 드로우 콜 수가 수천 단위 발생
        
    -   최적화 후 드로우 콜 수를 수백 단위로 축소
        
    -   CPU 프로파일링 기준, 드로우 콜 처리 시간을 5ms → 1ms 이내로 단축
        
-   **모바일 환경 UI 문제**
    
    -   디바이스별 해상도 차이로 UI가 틀어지는 현상 발생
        
    -   해결: 앵커 설정과 동적 레이아웃 변경을 적용하여 다양한 화면에서도 UI 정상 표시
 

-   **영지 시너지 UI 패널 성능 및 확장성 문제**
    
    -   SynergyInfoItem UI를 Instantiate/Destroy로 반복 생성/파괴하여 GC(가비지 컬렉션)로 인한 화면 끊김 유발.
        
    -   해결: ObjectPoolManager를 활용, Instantiate 대신 Get(), Destroy 대신 ReleaseSelf() (반납) 로직으로 변경하여 GC 부담 최소화
 
-   **팝업 기능 통일화**
    
    -   처음 기획에는 없었던 뒤로가기 버튼, 통일 되지 않은 팝업창 문제
        
    -   해결: BasePopUpUI를 구현하여 뒤로가기 버튼과 배경을 눌렀을 때도 팝업이 꺼지게 함
----------

## 12. 개선된 사항 
   
-   **데이터 매니저 확장성 개선**
    
    -    문제점: 엑셀 파일 하나에 여러 시트를 두고 작업하는 경우가 많았음.
        
    -   개선 사항: 다중 시트를 효율적으로 처리할 수 있도록 데이터 매니저 구조 개선
- **플레이어 데이터 매니저 개선**

    -    문제점: 플레이어 데이터 매니저 안에 너무나 많은 정보들이 담겨져 있어서 코드 가독성이나 유지 보수가 어려웠음.
 
    - 개선사항:
      -   '플레이어 데이터'와 '영지 데이터'의 책임을 명확히 분리하여 코드 가독성 및 유지보수성 향상.
            
        -   `PlayerDataManager`는 재화/덱 등 계정 정보에만, `TileDataHandler`는 영지 시스템에만 집중하도록 응집도 향상.
     
-  **이벤트 매니저 구현**

    -    문제점:PlayerDataManager가 ResourceUI를, MainScreenBuildingController가 SynergyOutlineManager를 직접 참조하는 등, 매니저 간의 결합도가 높아 기능 추가 및 수정이 어려웠음.

     
 - 개선사항:
      -   옵저버 패턴 기반의 **EventManager**를 도입하여, '발행/구독(Publish/Subscribe)' 방식으로 시스템 간 통신을 중재함
            
  -  **UI 메뉴 부분 (UI 흐름 개선)**

    -    문제점: 가챠 (모험가 길드) 등 핵심 콘텐츠가 영지 화면(MainScreenUI)의 특정 타일(외교 구역) 내부에 숨겨져 있어, 접근성이 낮고 유저가 기능을 찾기 어려웠음.

     
  - 개선사항:
      -  별도의 UIMenu 씬(허브)을 신설하여, 영지/전투/계약(가챠)/도감 등 핵심 콘텐츠로 즉시 접근할 수 있도록 UI 흐름을 개선함.
      -  UIManager에 fromUI 플래그를 두어, 도감이나 스테이지 선택 등 공용 UI에서 "뒤로가기" 시 컨텍스트에 맞는 이전 화면(메뉴 또는 영지)으로 정확히 돌아가도록 로직을 구현함.
  
  -  **배틀씬 사용 버튼 개선**


    -    문제점: 전투 씬 내에 유닛과 유물 정보를 확인할 수 있는 UI가 없어, 플레이어의 직관적인 전략 판단이 어려웠음.

     
   -    개선사항:
      -  전투 씬에서 유닛/유물 아이콘을 **짧게 클릭**하면 즉시 소환/사용되도록 하고, **길게 클릭**할 경우에는 해당 유닛/유물의 **상세 정보 팝업**이 표시되도록 이벤트를 분리하여, 플레이어가 전투 중에도 직관적으로 정보를 확인할 수 있게 개선4

